custom/ReadMe
Copyright (c) 2004 Cadence Research Systems

This directory contains a configuration script, set of make files,
and C and Scheme files that are used to rebuild the Chez Scheme and
Petite Chez Scheme executable images and heap files with or without
local customizations.

-------------
Installation:

To install Chez Scheme or Petite Chez Scheme without local customizations,
simply type the following commands:

   ./configure
   make install

The configure script has several options you might wish to use to
customize the installation; type

   ./configure --help

for information.

If you wish to test the build before installing it, run make without
the install argument:

   ./configure
   make

To test the installation, you need to tell Scheme where to find its
boot or heap files by setting the SCHEMEHEAPDIRS variable.  Heap files,
if created for this platform, are created in this directory, while boot
files are in the boot directory parallel to this directory.  The following
will set the heap and boot file search path to look in both directories:

sh/bash:
   SCHEMEHEAPDIRS=".:../boot/%m:" ; EXPORT SCHEMEHEAPDIRS

csh/tcsh:
   setenv SCHEMEHEAPDIRS ".:../boot/%m:"

Now you can start Petite Chez Scheme or Chez Scheme as follows:

   ./petite
   ./scheme

Either should print a greeting and a right-angle prompt.  Try typing a
Scheme expression at the prompt.  Hit ^D or enter (exit) when you
satisfied that the system build worked.

At this point, you can complete the install by typing

    make install

To test the installation, should unset the SCHEMEHEAPDIRS variable

sh/bash:
   unset SCHEMEHEAPDIRS

csh/tcsh:
   unsetenv SCHEMEHEAPDIRS

then run either /usr/bin/petite or /usr/bin/scheme:

   /usr/bin/petite
   /usr/bin/scheme

--------------
Customization:

To include custom C code in the executable image, edit the make file
"Makefile" generated by configure to add any C object files you would like
to include.  Edit custom_init in the C source file "custom.c" to add
foreign_symbol declarations for each of the procedures you wish to make
available to Scheme code, and edit "Makefile" to override use of the
standard "custom.o" object file.

To include custom Scheme code in the heap image, edit "Makefile" to add
any Scheme source or object files you would like to include.  If heaps
are not used on the target system, you will have to load these files
explicitly on startup.

You may wish to create a Scheme source file "custom.ss" containing
foreign procedure definitions for each of the C procedures you made
available in custom_init.  Be sure to to add "custom.ss" or "custom.so"
to the list of Scheme files to be included.

Make a backup copy of your modified Makefile so that it isn't destroyed
by a subsequent use of ./configure.

See the files crepl.c, sample.c, and sample.ss for sample C and Scheme
customization code.

More elaborate customizations may involve the creation of specialized
make files, patterned on the existing make files.

--------
Cleanup:

Type 'make clean' to remove build products or 'make distclean' to remove
build products and the make files generate by configure.
