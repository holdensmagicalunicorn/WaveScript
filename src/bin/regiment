#! /bin/bash

#scheme -h regimentc.1.heap $*
#chez -h regimentc.1.heap $*

# Use a default location if it is not set.
if ! [ $REGIMENTD ]; then 
    if [ -d $HOME/regiment_alpha ];
    then REGIMENTD=$HOME/regiment_alpha/; 
    elif [ -d $HOME/macroprogramming/regiment_alpha ];
    then REGIMENTD=$HOME/macroprogramming/regiment_alpha/; 

    elif [ -d /usr/regiment/ ];
    then REGIMENTD=/usr/regiment/; 
    elif [ -d /usr/local/regiment/ ];
    then REGIMENTD=/usr/local/regiment/; 
    fi;
fi

#MT=`echo '(display (machine-type))' | $REGIMENTD/depends/petite -q`
MACHINE=`uname`
if [ $MACHINE == "Linux" ];
then MT=i3le;
elif [ $MACHINE == "Darwin" ];
then MT=ppcosx;
elif [ $MACHINE == "Windows" ];
then MT=i3nt;
else echo Unknown platform for scheme system: $MACHINE
fi

# echo RUNNING ON MACHINE TYPE: $MT

# If we can we use the stored heap, otherwise we run it as a script.
if [ "$REGOPTLVL" == "3" ];
then (if [ -f $REGIMENTD/src/build/$MT/regiment.0.OPT.heap ];
      then exec $REGIMENTD/depends/rawscheme -h $REGIMENTD/src/build/$MT/regiment.0.OPT.heap $*;
      else exec $REGIMENTD/src/regiment_script.ss $*
      fi);
elif [ -f $REGIMENTD/src/build/$MT/regiment.0.heap ];
then #echo Running regiment from saved heap...;
    exec $REGIMENTD/depends/rawscheme -h $REGIMENTD/src/build/$MT/regiment.0.heap $*;
else exec $REGIMENTD/src/regiment_script.ss $*;
fi
