#!/bin/sh

#TMP=/tmp/`whoami`/wavescript_parsed.tmp

if [ ! -f "$1" ];
then echo Usage: "wsc <file> <options ...>";
#     echo   (Options: -b  Build cpp file.)
     echo 
     echo   File \"$1\" does not exist.
     exit 1;
fi

if [ ! -d /tmp/`whoami` ]; 
then mkdir /tmp/`whoami`;
fi


D=`dirname "$1"`
B=`basename "$1"`
abspath="`cd \"$D\" 2>/dev/null && pwd || echo \"$D\"`/$B"

export REGIMENT_OR_WAVESCRIPT=WS
if regiment wscaml $abspath ${1+"$@"} ;
then echo
else #rm -f $TMP; 
    echo Compilation aborted: \"regiment wscomp\" exited with error code.
    exit 1;
fi

#if wsc-g++ ./query
#then echo; else exit 1; fi;
#

# Inline factor should be, say, 3:
#if ocamlopt.opt -unsafe -ffast-math -inline 100 query.ml -o query.exe
if ocamlopt.opt query.ml -o query.exe
then echo "Executable output to 'query.exe'.";
fi


