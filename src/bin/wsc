#!/bin/sh

#TMP=/tmp/`whoami`/wavescript_parsed.tmp

if [ ! -f "$1" ];
then echo Usage: "wsc <file> <options ...>";
#     echo   (Options: -b  Build cpp file.)
     echo 
     echo   File \"$1\" does not exist.
     exit 1;
fi

if [ ! -d /tmp/`whoami` ]; 
then mkdir /tmp/`whoami`;
fi


D=`dirname "$1"`
B=`basename "$1"`
abspath="`cd \"$D\" 2>/dev/null && pwd || echo \"$D\"`/$B"

export REGIMENT_OR_WAVESCRIPT=WS
if regiment wscomp $abspath ${1+"$@"} ;
then echo
else #rm -f $TMP; 
    echo Compilation aborted: \"regiment wscomp\" exited with error code.
    exit 1;
fi
#rm -f $TMP

# If this flag is set, we stop here.
# HACK: accepts the argument only in this position:
#if test "$2" == "-c0" ; 
#then exit 0
#fi

if [ ! -d "$WAVESCOPED" ]; 
then echo WAVESCOPED directory, \"$WAVESCOPED\", does not exist.  Can\'t execute query.; 
     exit 1;
fi

#echo
#echo
#(cd $WAVESCOPED; make WaveScriptQuery)
#echo Writing scipt \"run_query\".  Use it to invoke the compiled query.
#echo '#!/bin/sh' > run_query
##echo '(cd $WAVESCOPED; ./run_WaveScriptQuery)' >> run_query
#echo '$WAVESCOPED/run_WaveScriptQuery $*' >> run_query
#chmod +x run_query

if wsc-g++ ./query
then echo
else exit 1;
fi;

echo "Executable output to 'query.exe'."
