#!/bin/sh


FIRST=`head -n1 "query.c"`
MATCH=`echo $FIRST | grep "^//WSLIBDEPS:"`
if [ "$MATCH" != "" ];
then 
   EXTRALIBS=`echo $FIRST | sed "s/\/\/WSLIBDEPS://"`
   WS_LINK="$WS_LINK $EXTRALIBS"
   echo Linking extra libraries requested by query file: $EXTRALIBS
fi

#========================================


ALWAYSON="-O3 -funroll-loops"
# max-unroll-times Seems to be 8 by default.
OPTFLAGS="$ALWAYSON --param max-unroll-times=16 "

## DEBUG MODE:
OPTFLAGS="-g -O0"

CMD="gcc $WS_LINK -lm $OPTFLAGS -o query.exe $WS_LINK query.c"
echo "$CMD"
if time $CMD;
then echo Compiled .c output successfully.
else echo ERROR, gcc failed.; exit 1
fi

wc query.c
