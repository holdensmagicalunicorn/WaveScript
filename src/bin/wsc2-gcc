#!/bin/sh


FIRST=`head -n1 "query.c"`
MATCH=`echo $FIRST | grep "^//WSLIBDEPS:"`
if [ "$MATCH" != "" ];
then 
   EXTRALIBS=`echo $FIRST | sed "s/\/\/WSLIBDEPS://"`
   WS_LINK="$WS_LINK $EXTRALIBS"
   echo Linking extra libraries requested by query file: $EXTRALIBS
fi

#========================================


ALWAYSON="-O3 -funroll-loops"
# max-unroll-times Seems to be 8 by default.
OPTFLAGS="$ALWAYSON --param max-unroll-times=16 "

## DEBUG MODE:
OPTFLAGS="-g -O0"

## ACK - include WS_LINK at front and end?!?

CMD="gcc $WS_LINK -lm $OPTFLAGS -o query.exe query.c $WS_LINK"
echo "$CMD"
#if gcc -I$TOSROOT/support/sdk/c -L$TOSROOT/support/sdk/c -lmote -I$TOSROOT/support/sdk/c/tos/types/ -lm -g -O0 -o query.exe query.c   -I$TOSROOT/support/sdk/c -L$TOSROOT/support/sdk/c -lmote -I$TOSROOT/support/sdk/c/tos/types/

if time $CMD;
then echo Compiled .c output successfully.
else echo ERROR, gcc failed.; exit 1
fi

wc query.c
